# Non-Functional Requirements (NFR)

| ID       | Название                         | Описание                                                   | Метрика/Порог                 | Проверка (чем/где)                 | Компонент | Приоритет |
|--------|----------------------------------|------------------------------------------------------------|-------------------------------|------------------------------------|-----------|-----------|
| NFR-01 | Время ответа API                 | Время ответа всех REST эндпоинтов не превышает установленный порог при нагрузке 50 RPS | p95 ≤ 200 мс @ 50 RPS         | Нагрузочный тест      | api       | High      |
| NFR-02 | Доступность сервиса              | Сервис должен быть доступен и корректно отвечать на /health | Uptime ≥ 99.5% за месяц       | Мониторинг (Grafana)   | platform  | High      |
| NFR-03 | Корректность статистики          | Показатель `completion_rate` рассчитывается точно при любых данных | Абсолютная ошибка ≤ 0.1%      | Unit-тесты на модуль /stats        | stats     | High      |
| NFR-04 | Целостность данных               | Отметка (`checkin`) не может существовать без связанной привычки | 100% валидных связей          | Unit + Integration тесты           | db/api    | High      |
| NFR-05 | Производительность записи        | Создание новой привычки или отметки не превышает лимит времени при 50 RPS | p95 ≤ 100 мс @ 50 RPS         | Нагрузочный тест (k6)              | api       | Medium    |
| NFR-06 | Единый формат ошибок             | Все ошибки возвращаются в формате `{"error": {"code": ..., "message": ...}}` | 100% endpoint’ов              | Контракт-тесты + e2e               | api       | Medium    |
| NFR-07 | Логирование ошибок               | Все исключения уровня ERROR логируются с timestamp и request_id | 100% ошибок зафиксировано     | Анализ логов + e2e тесты           | observability | Medium |
| NFR-08 | Хранение паролей                 | Пароли пользователей хэшируются с помощью Argon2id   | t=3, m=256MB, p=1             | Конфиг + unit-тест                 | auth      | High      |
| NFR-09 | Жизненный цикл JWT токенов       | Срок жизни JWT-токенов не превышает 24 часа                 | TTL ≤ 24h                     | Проверка конфигурации + e2e тест   | auth      | Medium    |
| NFR-10 | Маскирование чувствительных данных | Личные данные (PII) не выводятся в логах и ответах ошибок   | 0 утечек PII                  | Static scan + e2e тест             | api/logging | High    |

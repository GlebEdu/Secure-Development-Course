# STRIDE — Угрозы и контроли для Habit Tracker App

| Поток/Элемент | Угроза (S/T/R/I/D/E) | Описание угрозы | Контроль | Ссылка на NFR | Проверка/Артефакт |
|---------------|---------------------|-----------------|----------|---------------|------------------|
| F1            | S                   | Перехват данных при передаче (habit payload, creds) | HTTPS/TLS шифрование | NFR-10 | Проверка SSL, PenTest |
| F1            | T                   | Попытка подделки запроса (например, CSRF) | JWT токены / CSRF токен | NFR-09 | e2e тесты, Unit-тесты auth |
| F2            | I                   | Некорректные данные в payload могут нарушить бизнес-логику | Валидация входных данных в Pydantic | NFR-04 | Unit-тесты Habits Service |
| F2            | D                   | Удаление или изменение чужой привычки | Проверка user_id и права доступа | NFR-04 | Unit-тесты, e2e auth |
| F3            | R                   | Несанкционированный доступ к чужим checkins | Проверка user_id / auth | NFR-04 | Unit-тесты, интеграционные тесты |
| F3            | S                   | Перехват payload при передачи | HTTPS/TLS | NFR-10 | Проверка TLS |
| F4            | I                   | Некорректный расчет completion_rate при поврежденных данных | Unit-тесты расчета статистики | NFR-03 | Unit-тест Stats Service |
| F4            | R                   | Несанкционированный доступ к агрегированным статистикам | Проверка аутентификации | NFR-09 | e2e auth-тесты |
| F5       | E                   | Утечка внутренней информации через ошибки | Централизованный обработчик ошибок ApiError | NFR-06, NFR-10 | Контракт-тесты API, сканер логов |
| F6        | D                   | Потеря данных или нарушение целостности (_DB без транзакций) | Проверка связей habit_id ↔ checkins | NFR-04 | Unit + Integration тесты |
| F7      | T                   | Несанкционированное удаление checkins | Контроль прав и проверка user_id | NFR-04 | Unit-тесты |
| F9  | E               | Логирование PII пользователя | Маскирование / фильтрация полей | NFR-10 | Static scan, e2e тест |
| FastAPI  | R                   | Перегрузка API (DoS) | Rate limiting / throttling | NFR-01, NFR-05 | Нагрузочный тест (k6) |
| FastAPI  | T                   | Попытка внедрения вредоносного payload (SQL/NoSQL injection) | Pydantic + ORM / валидация | NFR-04 | Unit-тесты, fuzz-тесты |
| F10           | S                   | Метрики могут быть перехвачены | HTTPS + безопасная передача | NFR-02 | Проверка TLS, мониторинг |
| F11           | E                   | Клиент может получить избыточную информацию об ошибках | Error envelope {"error": {...}} | NFR-06, NFR-10 | Контракт-тесты API |
